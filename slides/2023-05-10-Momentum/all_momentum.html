<!doctype html>
<meta charset="utf-8">
<!-- <meta name="viewport" content="width=1080"> -->
<script src="http://distill.pub/template.v1.js"></script>


<!-- Katex -->
<!--<script src="assets/lib/auto-render.min.js"></script>-->
<!--<script src="assets/lib/katex.min.js"></script>-->
<link rel="stylesheet" href="assets/lib/katex.min.css">
<link rel="stylesheet" type="text/css" href="assets/widgets.css">

<!-- Required -->
<script src="assets/lib/lib.js"></script>
<script src="assets/utils.js"></script>
<script>
  var renderQueue = [];
  function renderMath(elem) {
    // renderMathInElement(
    //     elem,
    //     {
    //         delimiters: [
    //             {left: "$$", right: "$$", display: true},
    //             {left: "$", right: "$", display: false},
    //         ]
    //     }
    // );
  }

  var deleteQueue = [];
  function renderLoading(figure) {
    var loadingScreen = figure.append("svg")
    .style("width", figure.style("width"))
    .style("height", figure.style("height"))
    .style("position","absolute")
    .style("top", "0px")
    .style("left","0px")
    .style("background","white")
    .style("border", "0px dashed #DDD")
    .style("opacity", 1)

    return function(callback) { loadingScreen.remove() };

  }

</script>
<div id="math-cache" style="display: none;">
  <dt-math class="star">\star</dt-math>
  <dt-math class="plus">+</dt-math>
  <dt-math class="minus">-</dt-math>
  <dt-math class="equals">=</dt-math>
  <dt-math class="alpha">\alpha</dt-math>
  <dt-math class="lambda">\lambda</dt-math>
  <dt-math class="beta">\beta</dt-math>
  <dt-math class="r">R</dt-math>
  <dt-math class="alpha-equals">\alpha=</dt-math>
  <dt-math class="beta-equals">\beta=</dt-math>
  <dt-math class="beta-equals-zero">\beta = 0</dt-math>
  <dt-math class="beta-equals-one">\beta=1</dt-math>
  <dt-math class="alpha-equals-one-over-lambda-i">\alpha = 1/\lambda_i</dt-math>
  <dt-math class="model">\text{model}</dt-math>
  <dt-math class="p">0 p_1</dt-math>
  <dt-math class="phat">0 \bar{p}_1</dt-math>
  <dt-math class="two-sqrt-beta">2\sqrt{\beta}</dt-math>
  <dt-math class="lambda-i">\lambda_i</dt-math>
  <dt-math class="lambda-i-equals-zero">\lambda_i = 0</dt-math>
  <dt-math class="alpha-gt-one-over-lambda-i">\alpha > 1/\lambda_i</dt-math>
  <dt-math class="max-sigma-one">\max\{|\sigma_1|,|\sigma_2|\} > 1</dt-math>
  <dt-math class="x-i-k">x_i^k - x_i^*</dt-math>
  <dt-math class="xi-i">\xi_i</dt-math>
  <dt-math class="beta-equals-one-minus">\beta = (1 - \sqrt{\alpha \lambda_i})^2</dt-math>
</div>
<script>
  function MathCache(id) {
    return document.querySelector("#math-cache ." + id).innerHTML;
  }
</script>


<svg style="display: none;">
  <g id="pointerThingy">
    <circle fill="none" stroke="#FF6C00" stroke-linecap="round" cx="0" cy="0" r="14"/>
    <circle fill="#FF6C00" cx="0" cy="0" r="11"/>
    <path id="XMLID_173_" fill="#FFFFFF" d="M-3.2-1.3c0-0.1,0-0.2,0-0.3c0-0.1,0-0.2,0-0.3c-0.6,0-1.2,0-1.8,0c0,0.6,0,1.2,0,1.8
      c0.2,0,0.4,0,0.6,0c0-0.4,0-0.8,0-1.2c0,0,0.1,0,0.1,0c0.3,0,0.5,0,0.8,0C-3.4-1.3-3.3-1.3-3.2-1.3c0,0.2,0,0.4,0,0.6
      c0.2,0,0.4,0,0.6,0c0,0.2,0,0.4,0,0.6c0.2,0,0.4,0,0.6,0c0,0,0,0,0-0.1c0-1.6,0-3.2,0-4.8c0-0.6,0-1.2,0-1.8c0,0,0,0,0.1,0
      c0.3,0,0.7,0,1,0c0.1,0,0.1,0,0.2,0c0-0.2,0-0.4,0-0.6c-0.4,0-0.8,0-1.2,0C-2-7.2-2-7-2-6.8c0,0,0,0-0.1,0c-0.2,0-0.3,0-0.5,0
      c0,0,0,0-0.1,0c0,1.8,0,3.6,0,5.5c-0.2,0-0.3,0-0.4,0C-3.1-1.3-3.2-1.3-3.2-1.3z M1.1-3.7C1-3.8,1-3.8,1.1-3.7C1-4,1-4.1,1-4.3
      c0,0,0,0,0-0.1c-0.4,0-0.8,0-1.2,0c0-0.8,0-1.6,0-2.4c-0.2,0-0.4,0-0.6,0c0,1.8,0,3.6,0,5.5c0.2,0,0.4,0,0.6,0c0-0.8,0-1.6,0-2.4
      c0,0,0.1,0,0.1,0C0.3-3.7,0.6-3.7,1.1-3.7C1-3.7,1-3.7,1.1-3.7C1.1-3.7,1-3.7,1.1-3.7c0,0.8,0,1.6,0,2.3c0,0,0,0.1,0,0.1
      c0.2,0,0.4,0,0.6,0c0-0.6,0-1.2,0-1.8c0.4,0,0.8,0,1.2,0c0,0.8,0,1.6,0,2.4c0.2,0,0.4,0,0.6,0c0-0.6,0-1.2,0-1.8c0.2,0,0.4,0,0.6,0
      c0,0,0,0,0,0.1c0,0.1,0,0.3,0,0.4c0,0,0,0.1,0,0.1c0.2,0,0.4,0,0.5,0c0,0,0.1,0,0.1,0.1c0,0.2,0,0.5,0,0.7c0,1.1,0,2.3,0,3.4
      c0,0,0,0,0,0.1c-0.2,0-0.4,0-0.6,0c0,0,0,0,0,0c0,0.6,0,1.1,0,1.7c0,0,0,0,0,0.1c-0.2,0-0.4,0-0.6,0c0,0.4,0,0.8,0,1.2
      c-1.6,0-3.2,0-4.9,0c0-0.4,0-0.8,0-1.2c-0.2,0-0.4,0-0.6,0C-2,3.8-2,3.4-2,3c-0.2,0-0.4,0-0.6,0c0,0.4,0,0.8,0,1.2
      c0.2,0,0.4,0,0.6,0C-2,4.8-2,5.4-2,6c2,0,4.1,0,6.1,0c0-0.1,0-0.2,0-0.3c0-0.5,0-0.9,0-1.4c0-0.1,0-0.1,0-0.2c0.2,0,0.4,0,0.5,0
      c0.1,0,0.1,0,0.1-0.1c0-0.4,0-0.9,0-1.3c0-0.1,0-0.3,0-0.4c0.1,0,0.2,0,0.3,0c0.1,0,0.2,0,0.3,0c0-1.4,0-2.8,0-4.3
      c-0.2,0-0.4,0-0.6,0c0-0.2,0-0.4,0-0.6c-0.2,0-0.4,0-0.6,0c0-0.2,0-0.4,0-0.6c-0.4,0-0.8,0-1.2,0c0-0.2,0-0.4,0-0.6
      c-0.1,0-0.2,0-0.3,0c-0.4,0-0.9,0-1.3,0C1.2-3.7,1.1-3.7,1.1-3.7z M-3.2,1.8c0,0.4,0,0.8,0,1.2c0.2,0,0.4,0,0.5,0
      c0.1,0,0.1,0,0.1-0.1c0-0.3,0-0.6,0-1c0-0.1,0-0.1,0-0.2C-2.8,1.8-3,1.8-3.2,1.8c0-0.4,0-0.8,0-1.2c-0.2,0-0.4,0-0.6,0
      c0-0.2,0-0.4,0-0.6c-0.2,0-0.4,0-0.6,0c0,0.2,0,0.4,0,0.6c0.2,0,0.4,0,0.6,0c0,0,0,0,0,0.1c0,0.1,0,0.3,0,0.4c0,0.2,0,0.5,0,0.7
      c0,0,0,0.1,0.1,0.1c0.1,0,0.2,0,0.3,0C-3.4,1.8-3.3,1.8-3.2,1.8z"/>
    <path id="XMLID_172_" fill="#FFFFFF" d="M4.1,4.2C4.1,4.2,4.1,4.2,4.1,4.2c0-0.6,0-1.2,0-1.8c0,0,0,0,0,0c0.2,0,0.4,0,0.6,0
      c0,0,0-0.1,0-0.1c0-1.1,0-2.3,0-3.4c0-0.2,0-0.5,0-0.7c0,0,0-0.1-0.1-0.1c-0.2,0-0.4,0-0.5,0c0,0,0-0.1,0-0.1c0-0.1,0-0.3,0-0.4
      c0,0,0-0.1,0-0.1c-0.2,0-0.4,0-0.6,0c0,0.6,0,1.2,0,1.8c-0.2,0-0.4,0-0.6,0c0-0.8,0-1.6,0-2.4c-0.4,0-0.8,0-1.2,0
      c0,0.6,0,1.2,0,1.8c-0.2,0-0.4,0-0.6,0c0,0,0-0.1,0-0.1c0-0.7,0-1.5,0-2.2c0,0,0-0.1,0-0.1l0,0c0.1,0,0.2,0,0.2,0
      c0.4,0,0.9,0,1.3,0c0.1,0,0.2,0,0.3,0c0,0.2,0,0.4,0,0.6c0.4,0,0.8,0,1.2,0c0,0.2,0,0.4,0,0.6c0.2,0,0.4,0,0.6,0c0,0.2,0,0.4,0,0.6
      c0.2,0,0.4,0,0.6,0c0,1.4,0,2.8,0,4.3c-0.1,0-0.2,0-0.3,0c-0.1,0-0.2,0-0.3,0c0,0.1,0,0.3,0,0.4c0,0.4,0,0.9,0,1.3
      c0,0.1,0,0.1-0.1,0.1C4.5,4.2,4.3,4.2,4.1,4.2L4.1,4.2z"/>
    <path id="XMLID_171_" fill="#FFFFFF" d="M4.1,4.2c0,0.1,0,0.1,0,0.2c0,0.5,0,0.9,0,1.4c0,0.1,0,0.2,0,0.3C2.1,6,0,6-2,6
      c0-0.6,0-1.2,0-1.8c-0.2,0-0.4,0-0.6,0c0-0.4,0-0.8,0-1.2C-2.4,3-2.2,3-2,3c0,0.4,0,0.8,0,1.2c0.2,0,0.4,0,0.6,0c0,0.4,0,0.8,0,1.2
      c1.6,0,3.2,0,4.9,0c0-0.4,0-0.8,0-1.2C3.7,4.2,3.9,4.2,4.1,4.2L4.1,4.2z"/>
    <path id="XMLID_170_" fill="#FFFFFF" d="M-2-6.8c0,0.6,0,1.2,0,1.8c0,1.6,0,3.2,0,4.8c0,0,0,0,0,0.1c-0.2,0-0.4,0-0.6,0
      c0-0.2,0-0.4,0-0.6c-0.2,0-0.4,0-0.6,0c0-0.2,0-0.4,0-0.6l0,0c0.1,0,0.1,0,0.2,0c0.1,0,0.3,0,0.4,0c0-1.8,0-3.6,0-5.5
      c0,0,0.1,0,0.1,0C-2.4-6.8-2.2-6.8-2-6.8C-2.1-6.8-2-6.8-2-6.8L-2-6.8z"/>
    <path id="XMLID_169_" fill="#FFFFFF" d="M1.1-3.7C1-3.7,1-3.7,1.1-3.7c-0.4,0-0.8,0-1.2,0c0,0,0,0-0.1,0c0,0.8,0,1.6,0,2.4
      c-0.2,0-0.4,0-0.6,0c0-1.8,0-3.6,0-5.5c0.2,0,0.4,0,0.6,0c0,0.8,0,1.6,0,2.4c0.4,0,0.8,0,1.2,0c0,0,0,0.1,0,0.1C1-4.1,1-4,1.1-3.7
      C1-3.8,1-3.8,1.1-3.7L1.1-3.7z"/>
    <path id="XMLID_168_" fill="#FFFFFF" d="M-3.2,1.8c-0.1,0-0.2,0-0.3,0c-0.1,0-0.2,0-0.3,0c0,0-0.1,0-0.1-0.1c0-0.2,0-0.5,0-0.7
      c0-0.1,0-0.3,0-0.4c0,0,0,0,0-0.1c-0.2,0-0.4,0-0.6,0c0-0.2,0-0.4,0-0.6c0.2,0,0.4,0,0.6,0c0,0.2,0,0.4,0,0.6c0.2,0,0.4,0,0.6,0
      C-3.2,0.9-3.2,1.3-3.2,1.8c0.2,0,0.4,0,0.6,0c0,0.1,0,0.1,0,0.2c0,0.3,0,0.6,0,1C-2.6,3-2.7,3-2.7,3c-0.2,0-0.3,0-0.5,0
      C-3.2,2.6-3.2,2.2-3.2,1.8z"/>
    <path id="XMLID_167_" fill="#FFFFFF" d="M-3.2-1.3c-0.1,0-0.2,0-0.3,0c-0.3,0-0.5,0-0.8,0c0,0,0,0-0.1,0c0,0.4,0,0.8,0,1.2
      c-0.2,0-0.4,0-0.6,0c0-0.6,0-1.2,0-1.8c0.6,0,1.2,0,1.8,0c0,0.1,0,0.2,0,0.3C-3.2-1.5-3.2-1.4-3.2-1.3L-3.2-1.3z"/>
    <path id="XMLID_166_" fill="#FFFFFF" d="M-2-6.8C-2-7-2-7.2-2-7.4c0.4,0,0.8,0,1.2,0c0,0.2,0,0.4,0,0.6c-0.1,0-0.1,0-0.2,0
      C-1.3-6.8-1.6-6.8-2-6.8C-2-6.8-2-6.8-2-6.8L-2-6.8z"/>
  </g>
</svg>

<dt-article class="centered">
  <h1>Why Momentum Really Works</h1>

  <figure style = "position:relative; width:984px; height:400px;">
    <div id="banana" style="position:relative; border: 1px solid rgba(0, 0, 0, 0.2);"></div>
    <div id="sliderAlpha" style="position:absolute; width:300px; height: 50px; left:20px; top: 320px;">
      <text class="figtext" style="top: -5px; left: 20px; position: relative;">Step-size α = 0.02</text>
    </div>
    <div id="sliderBeta" style="position:absolute; width: 300px; height: 50px; left: 280px; top: 320px;;">
      <text class="figtext" style="top: -5px; left: 20px; position: relative;">Momentum β = 0.99</text>
    </div>
    <figcaption id="Bananacaption" style="position:absolute; width: 420px; height: 90px; left: 540px; top: 320px;">
      We often think of Momentum as a means of dampening oscillations and speeding up the iterations, leading to faster convergence. But it has other interesting behavior. It allows a larger range of step-sizes to be used, and creates its own oscillations. What is going on?
    </figcaption>
  </figure>

  <dt-byline class="l-page"></dt-byline>

  <script src="assets/lib/contour_plot.js"></script>
  <script src="assets/iterates.js"></script>
  
  <script>

  // Render Foreground
  var iterControl = genIterDiagram(bananaf, [1,1/3], [[-2,2],[2/3 + 0.4,-2/3 + 0.4]])
                    .alpha(0.003)
                    .beta(0)
                    (d3.select("#banana").style("position","relative"))

  var iterChange = iterControl.control
  var getw0 = iterControl.w0

  var StepRange = d3.scaleLinear().domain([0,100]).range([0,0.0062])
  var MomentumRange = d3.scaleLinear().domain([0,100]).range([0,0.98])

  var update = function (i,j) { iterChange(i, 0, getw0()) }

  var slidera = sliderGen([230, 40])
              .ticks([0,0.003,0.006])
              .ticktitles( function(d,i) { return ["0", "0.003", "0.006"][i]})
              .change( function (i) {
                d3.select("#sliderAlpha").selectAll(".figtext").html("Step-size α = " + getalpha().toPrecision(2) )
                iterChange(getalpha(), getbeta(), getw0() )
              } )
              .startxval(0.003)
              .cRadius(7)
              .shifty(-12)
              .margins(20,20)

  var sliderb = sliderGen([230, 40])
              .ticks([0,0.5,0.99])
              .change( function (i) {
                d3.select("#sliderBeta").selectAll(".figtext").html("Momentum β = " + getbeta().toPrecision(2) )
                iterChange(getalpha(), getbeta(), getw0() )
              } )
              .cRadius(7)
              .shifty(-12)
              .startxval(0.74)
              .margins(20,20)

  var getalpha = slidera( d3.select("#sliderAlpha")).xval
  var getbeta  = sliderb( d3.select("#sliderBeta")).xval

  iterChange(getalpha(), getbeta(), getw0() )

  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->  


  <figure style = "width:750px; height:340px; display:block; margin-left:auto; margin-right:auto; position:relative" id = "change_of_variables">
  <div id = "mom1" style="width:400px; position:absolute; left:0px; top:0px"></div>
  <div id = "mom2" style="width:400px; position:absolute; left:400px; top:0px"></div>
  </svg>
  </figure>
  
  <script>
  deleteQueue.push(renderLoading(d3.select("#change_of_variables")))
  renderQueue.push(function(callback) {
    var U = givens(Math.PI/4)
    var Ut = numeric.transpose(U)
    // Render Foreground
    var left = d3.select("#mom1").style("border", "1px solid rgba(0, 0, 0, 0.2)")

    var c1 = genIterDiagram(quadf,  [0,0], [[-3,3],[-3,3]])
              .width(340)
              .height(340)
              .iters(300)
              .alpha(0.018)
              .showSolution(false)
              .pathWidth(1)
              .circleRadius(1.5)
              .pointerScale(0.8)
              .showStartingPoint(false)
              .drag(function() {
                c2.control(c1.alpha(),
                          c1.beta(),
                          numeric.dot(U,c1.w0())) })
              (left)

    var right = d3.select("#mom2").style("border", "1px solid rgba(0, 0, 0, 0.2)")
    var c2 = genIterDiagram(eyef,  [0,0], [[-3,3],[-3,3]])
              .width(340)
              .height(340)
              .iters(300)
              .alpha(0.018)
              .showSolution(false)
              .pathWidth(1)
              .circleRadius(1.5)
              .pointerScale(0.8)
              .showStartingPoint(false)
              .drag(function() {
                c1.control(c2.alpha(),
                          c2.beta(),
                          numeric.dot(Ut,c2.w0())) })
              (right)

  // Initialize
  c2.control(0.018,0,[-2.5,1])
  c1.control(0.018,0,numeric.dot(Ut,[-2.5,1]));
  callback(null);
  });

  </script>

  
<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure style="position:relative; width:920px; height:360px" id = "milestones_gd">
  <figcaption style="position:absolute; text-align:left; left:135px; width:350px; height:80px">Optimization can be seen as combination of several component problems, shown here as <svg style="position:relative; top:2px; width:3px; height:14px; background:#fde0dd"></svg> 1 <svg style="position:relative; top:2px; width:3px; height:14px; background:#fa9fb5"></svg> 2 <svg style="position:relative; top:2px; width:3px; height:14px; background:#c51b8a"></svg> 3 with eigenvalues <svg style="position:relative; top:2px; width:3px; height:14px; background:#fde0dd"></svg> <dt-math>\lambda_1=0.01</dt-math>, <svg style="position:relative; top:2px; width:3px; height:14px; background:#fa9fb5"></svg> <dt-math>\lambda_2=0.1</dt-math>, and <svg style="position:relative; top:2px; width:3px; height:14px; background:#c51b8a"></svg> <dt-math>\lambda_3=1</dt-math> respectively. </figcaption>

<!-- ["#fde0dd", "#fa9fb5", "#c51b8a"]
 -->
  <div id = "sliderStep" style="position:absolute; left:550px; width:250px; height:100px">

    <div id="stepSizeMilestones"
         class="figtext"
         style="position:absolute; left:15px; top:15px">
         Step-size
    </div>

    <div class="figtext2" id="milestones_gd_optstep"
      style="position:absolute; font-size:11px; left:152px; top:18px; z-index:10; cursor: pointer">
      Optimal Step-size
    </div>

    <svg style="position:absolute; font-size:10px; left:224px; top:34px">
<line marker-end="url(#arrowhead)" style="stroke: black; stroke-width: 1.5; visibility: visible;" x2="5" y2="10" x1="5" y1="0"></line>
    </svg>

  </div>
  <div id = "obj"></div>
  </figure>
  <script src="assets/milestones.js"></script>
  <script>
    deleteQueue.push(renderLoading(d3.select("#milestones_gd")))
    renderQueue.push(function(callback) {
      var graphDiv = d3.select("#obj")
                      .style("width",  920 + "px")
                      .style("height", 300 + "px")
                      .style("top", "90px")
                      .style("position", "relative")
                      .style("margin-left", "auto")
                      .style("margin-right", "auto")
                      .attr("width", 920)
                      .attr("height", 500)

      var svg = graphDiv.append("svg")
                        .attr("width", 920)
                        .attr("height", 300)
                        .style("position","absolute")
                        .style("left", "15px")

      var updateSliderGD = renderMilestones(svg, function() {});

      var alphaHTML = MathCache("alpha-equals");

      var slidera = sliderGen([250, 80])
                  .ticks([0,1,200/(101),2])
                  .change( function (i) {
                    var html = alphaHTML + '<span style="font-weight: normal;">' + i.toPrecision(4) + "</span>";
                    d3.select("#stepSizeMilestones")
                      .html("Stepsize " + html )
                    updateSliderGD(i,0.000)
                  } )
                  .ticktitles(function(d,i) { return [0,1,"",2][i] })
                  .startxval(200/(101))
                  .cRadius(7)
                  .shifty(-12)
                  .shifty(10)
                  .margins(20,20)(d3.select("#sliderStep"))


      // renderDraggable(svg, [133.5, 23], [114.5, 90], 2, " ").attr("opacity", 0.1)
      // renderDraggable(svg, [133.5, 88], [115.5, 95], 2, " ").attr("opacity", 0.1)
      // renderDraggable(svg, [132.5, 154], [114.5, 100], 2, " ").attr("opacity", 0.1)

      d3.select("#milestones_gd_optstep").on("click", slidera.init)

      svg.append("text")
        .attr("class", "katex morsd mathit")
        .style("font-size", "19px")
        .style("font-family","KaTeX_Math")
        .attr("x", 105)
        .attr("y", 50)
        .attr("text-anchor", "end")
        .attr("fill", "gray")
        .html("f(w<tspan baseline-shift = \"super\" font-size = \"15\">k</tspan>) - f(w<tspan baseline-shift = \"super\" font-size = \"15\">*</tspan>)")



      svg.append("text")
        .style("font-size", "13px")
        .attr("x", 0)
        .attr("y", 80)
        .attr("dy", 0)
        .attr("transform", "translate(110,0)")
        .attr("class", "caption")
        .attr("text-anchor", "end")
        .attr("fill", "gray")
        .text("At the initial point, the error in each component is equal.")

      svg.selectAll(".caption").call(wrap, 100)


      svg.append("text")
        .style("font-size", "13px")
        .attr("x", 420)
        .attr("y", 270)
        .attr("dy", 0)
        .attr("dx", -295)
        .attr("text-anchor", "start")
        .attr("fill", "gray")
        .text("At the optimum, the rates of convergence of the largest and smallest eigenvalues equalize.")

      callback(null);
    });
  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id = "poly0f" style="width:940px; height:200px">
    <div id = "poly0" style="width:940px; height:185px; position:absolute; top:20px"></div>
  </figure>
  <script src="assets/eigensum.js"></script>
  <script>
  deleteQueue.push(renderLoading(d3.select("#poly0")))
  renderQueue.push(function(callback) {

    // Preprocess x, get eigendecomposition, etc
    var x = [-0.6, -0.55,-0.5,-0.45,-0.4,0.4,0.45,0.5,0.55,0.6]
    var D = vandermonde(x, 5)
    var Eigs = eigSym(numeric.dot(numeric.transpose(D),D))
    var U = Eigs.U
    var lambda = Eigs.lambda

    // Preprocess y
    var b = [-3/2,-4/2,-5/2,-3/2,-2/2,1/2,2/2,3/2,2/2,1/2]
    var Dtb = numeric.dot(b,D)
    var sol = numeric.mul(numeric.dot(U, Dtb), lambda.map(inv))

    var step = 1.8/lambda[0]
    var iter = geniter(U, lambda, Dtb, step)

    var eigensum = d3.select("#poly0")

    var wi = [-2,-2,2,2,2,-2]

    function refit(b) {
      var Dtb = numeric.dot(b,D)
      var sol = numeric.mul(numeric.dot(U, Dtb), lambda.map(inv))
      var Utsol = numeric.dot(sol,U)
      eigenControl.updateweights(Utsol)
    }

    var eigenControl = renderEigenPanel(eigensum, numeric.identity(6), x, b, wi, refit);

    // Swoopy Annotator
    var annotations = [
    {
      "x": 0,
      "y": 0,
      "path": "M 60,5 A 19.018 19.018 0 0 0 36,27",
      "text": "scrub values",
      "textOffset": [
        64,
        9
      ]
    }
    ]

    drawAnnotations(d3.select("#poly0f"), annotations)

    callback(null);
  });

  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id = "poly1" style="width:940px; height:285px"></figure>

  <script>
  deleteQueue.push(renderLoading(d3.select("#poly1")))
  renderQueue.push(function(callback) {
    var inv = function(lambda) { return 1/lambda }
    var scal = function(lambda) { return lambda < 1e-10 ? -100 : 1.5/Math.sqrt(lambda) }

    // Preprocess x, get eigendecomposition, etc
    var x = [-0.6, -0.55,-0.5,-0.45,-0.4,0.4,0.45,0.5,0.55,0.6]
    var D = vandermonde(x, 5)
    var Eigs = eigSym(numeric.dot(numeric.transpose(D),D))
    var U = Eigs.U
    var lambda = Eigs.lambda

    // Preprocess y
    var b = [-3/2,-4/2,-5/2,-3/2,-2/2,1/2,2/2,3/2,2/2,1/2]
    var Dtb = numeric.dot(b,D)
    var sol = numeric.mul(numeric.dot(U, Dtb), lambda.map(inv))

    var step = 1.8/lambda[0]
    var iter = geniter(U, lambda, Dtb, step)

    var eigensum = d3.select("#poly1")

    var wi = lambda.slice(0).map(scal)

    function refit(b) {
      var Dtb = numeric.dot(b,D)
      var sol = numeric.mul(numeric.dot(U, Dtb), lambda.map(inv))
      var Utsol = numeric.dot(sol,U)
      eigenControl.updateweights(sol)
    }

    var eigenControl = renderEigenPanel(eigensum, U, x, b, wi, refit, true)

    var annotate = eigensum

    annotate.append("figcaption")
    .style("width", 230 + "px")
    .style("height", 150 + "px")
    .style("left", "0px")
    .style("position", "absolute")
      .style("padding", "10px")
    .html("The data comes in 2 clusters. The first 2 eigenfeatures capture variations between the clusters. ")

    annotate.append("figcaption")
    .style("width", 230 + "px")
    .style("height", 150 + "px")
    .style("left", "260px")
    .style("position", "absolute")
    .style("padding", "10px")
    .html("Next there are smooth variations within clusters, peaks within clusters,")

    annotate.append("figcaption")
    .style("width", 230 + "px")
    .style("height", 150 + "px")
    .style("left", 530 + "px")
    .style("position", "absolute")
    .style("padding", "10px")
    .html("and finally, jagged polynomials which differ wildly on neighboring points. ");

    // Swoopy Annotator
    var annotations = [
    {
      "x": 0,
      "y": 0,
      "path": "M 807,198 A 26.661 26.661 0 0 1 838,159",
      "text": "drag points to fit data",
      "textOffset": [
        799,
        214
      ]
    }]

    drawAnnotations(eigensum, annotations)
    callback(null);
  });

  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id = "poly2" style="width:940px; height:360px"></figure>

  <script>
  deleteQueue.push(renderLoading(d3.select("#poly2")))
  renderQueue.push(function(callback) {
    var inv = function(lambda) { return 1/lambda }
    var scal = function(lambda) { return lambda < 1e-10 ? -100 : 1.5/Math.sqrt(lambda) }

    // Preprocess x, get eigendecomposition, etc
    var x = [-0.6, -0.55,-0.5,-0.45,-0.4,0.4,0.45,0.5,0.55,0.6]
    var b = [-3/2,-4/2,-5/2,-3/2,-2/2,1/2,2/2,3/2,2/2,1/2]

    var D = vandermonde(x, 5)
    var Eigs = eigSym(numeric.dot(numeric.transpose(D),D))
    var U = Eigs.U
    var lambda = Eigs.lambda

    // Preprocess y
    var Dtb = numeric.dot(b,D)
    var sol = numeric.mul(numeric.dot(U, Dtb), lambda.map(inv))

    var step = 1.8/lambda[0]
    var iter = geniter(U, lambda, Dtb, step)

    var eigensum = d3.select("#poly2")

    var wi = lambda.slice(0).map(scal)

    function refit(b) {
      var Dtb = numeric.dot(b,D)
      iter = geniter(U, lambda, Dtb, step)
      onChange(sliderControl.slidera.xval())
    }

    var eigenControl = renderEigenPanel(eigensum, U, x, b, wi, refit, true)

    var barlengths = getStepsConvergence(lambda, step).map(Math.log)

    var onChange = function(i) {
      eigenControl.updateweights(numeric.dot(U,iter(Math.floor(Math.exp(i-0.1)) )))
    }

    var sliderControl = sliderBarGen(barlengths, function(i) {return Math.exp(i-0.1)}).update(onChange)(d3.select("#poly2"))

    d3.select("#poly2").append("figcaption")
          .style("width", "120px")
          .style("position", "absolute")
          .style("left", "820px")
          .style("top","200px")
          .html("When an eigenspace has converged to three significant digits, the bar greys out. Drag the observations to change fit.")

    sliderControl.slidera.init()

    // var figwidth = d3.select("#poly2").style("width")
    // var figheight = d3.select("#poly2").style("height")
    // var svgannotate = d3.select("#poly2")
    //                     .append("svg")
    //                     .style("width", figwidth)
    //                     .style("height", figheight)
    //                     .style("position", "absolute")
    //                     .style("top","0px")
    //                     .style("left","0px")
    //                     .style("pointer-events","none")

    // renderDraggable(svgannotate,
    //                 [139.88888549804688, 243.77951049804688],
    //                 [121.88888549804688, 200.77951049804688],
    //                 5,
    //                 "We begin at x=w=0");

    // Swoopy Annotator
    var annotations = [
      {
        "x": 0,
        "y": 0,
        "path": "M 74,202 A 52.274 52.274 0 0 0 134,245",
        "text": "We begin at x=w=0",
        "textOffset": [
          21,
          198
        ]
      }
    ]

    drawAnnotations(d3.select("#poly2"), annotations)


    callback(null);
  });

  </script>
 
<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id = "momentum2D" style="width:984px; height:540px">
    <div class = "l-body" style="display:block">
      <div id = "momentumCanvas" style="position:absolute; left:45px"></div>
      <div id = "momentumAnnotation" style="position:absolute; width: 204px; height: 80px; left: 630px; top: 20px;"></div>
      <div style="position:absolute; width: 204px; height: 80px; left: 643px; top: 10px;" class ="figtext" >
        Convergence Rate

      </div>

      <figcaption style="position:absolute; width: 204px; height: 80px; left: 645px; top: 86px;">
      A plot of <dt-math>\max\{|\sigma_1|, |\sigma_2|\}</dt-math> reveals distinct regions, each with its own style of convergence.
      </figcaption>

    </div>
    <div id = "taxonomy"></div>
    <svg id="momentumOverlay" style="position:absolute; width:984px; height:540px; z-index:4; pointer-events:none"></svg>
  </figure>
  <script src="assets/momentum.js"></script>
  <script>
  deleteQueue.push(renderLoading(d3.select("#momentum2D")))
  renderQueue.push(function(callback) {
    var defaults = [[0.0015, 0.9],
                    [0.0015, 0.125],
                    [0.01, 0.00001],
                    [0.02, 0.05   ],
                    [0.025, 0.235 ]]

    coor = render2DSliderGen(
      function(a,b,bold) {
        var xy = coor(a,b)
        updatePaths[0](xy[0], xy[1],bold)
        updateStemGraphs[0](a,b)
      },
      function(a,b,bold) {
        var xy = coor(a,b)
        updatePaths[1](xy[0], xy[1],bold)
        updateStemGraphs[1](a,b)
      },
      function(a,b,bold) {
        var xy = coor(a,b)
        updatePaths[2](xy[0], xy[1],bold)
        updateStemGraphs[2](a,b)
      },
      function(a,b,bold) {
        var xy = coor(a,b)
        updatePaths[3](xy[0], xy[1],bold)
        updateStemGraphs[3](a,b)
      },
      function(a,b,bold) {
        var xy = coor(a,b)
        updatePaths[4](xy[0], xy[1],bold)
        updateStemGraphs[4](a,b)
      }, defaults)(d3.select("#momentumCanvas"))

    var tax = renderTaxonomy(d3.select("#momentum2D"))

    var updatePaths = renderOverlay(d3.select("#momentumOverlay"), tax.div)
    var updateStemGraphs = tax.update

    colorMap(
      d3.select("#momentumAnnotation"),
      180,
      d3.scaleLinear().domain([0,0.3,0.5,0.7,1,1.01]).range(colorbrewer.YlGnBu[5].concat(["black"])),
      d3.scaleLinear().domain([0,1.2001]).range([0, 180])
    )

    var up = function (i, alpha, beta) {
              var xy = coor(alpha, beta)
              updatePaths[i](xy[0], xy[1], true)
              updateStemGraphs[i](alpha,beta)
            }

    for (var i = 0; i<5; i++) {
      up(i,defaults[i][0], defaults[i][1])
    }

    renderMath(document.getElementById("momentum2D"))

    callback(null);
  });
  </script>
 
<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->

  <script src = "assets/phasediagram_description.js"></script>
  <figure id = "phasediagram0" style="position:relative; width:970px; height:540px;margin-left:auto; margin-right:auto">
  <div id = "phasediagram0div"; style="position:absolute; left:80px; top:10px"></div>
  </figure>
  <script>
    deleteQueue.push(renderLoading(d3.select("#phasediagram0")))
    renderQueue.push(function(callback) {
      phaseDiagram_dec(d3.select("#phasediagram0div"))
      renderMath(d3.select("#phasediagram0div").node())

      var figure = d3.select("#phasediagram0")
      var figwidth = figure.style("width")
      var figheight = figure.style("height")

      var svg = figure.append("svg")
                .style("width", figwidth)
                .style("height", figheight)
                .style("position", "absolute")
                .style("top","0px")
                .style("left","0px")
                .style("pointer-events", "none")

      renderDraggable(svg, [178.5, 66], [199.5, 66], 4, "Initial point <tspan x=\"0\" dy=\"1.2em\">x = 1, y = 1</tspan>").attr("opacity", 0.5)
      // renderDraggable(svg, [185, 116], [234, 174], 4, "constant speed").attr("opacity", 0.5)
      // renderDraggable(svg, [470, 86], [445, 71], 4, "slows to a halt").attr("opacity", 0.5)
      // renderDraggable(svg, [740, 64], [718, 97], 4, "all energy lost in 1 step").attr("opacity", 0.5)
      // renderDraggable(svg, [219, 269], [246, 327], 4, "particle returns slowly").attr("opacity", 0.5)
      // renderDraggable(svg, [250, 433], [287, 468], 4, "particle returns quickly").attr("opacity", 0.5)
      callback(null);
      renderMath(document.getElementById("phasediagram0"))

    });
  </script>

<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id = "phasediagram1" style="position:relative; width:648px; height:490px; margin-left: auto; margin-right: auto"></figure>
  </div>
  <script src="assets/phasediagram.js"></script>
  <script>
    deleteQueue.push(renderLoading(d3.select("#phasediagram1")))
    renderQueue.push(function(callback) {
      phaseDiagram(d3.select("#phasediagram1"));
      renderMath(document.getElementById("phasediagram1"))
      callback(null);
    });
  </script>
  
<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->

  <figure id="milestonesMomentumFig" style="position:relative; width:920px; height:460px">
  <figcaption style="position:absolute; text-align:left; top:30px; left:135px; width:280px; height:120px">We can do the same decomposition here with momentum, with eigenvalues
    <span style="display: inline-block; padding-left: 4px; border-left: 3px solid #fde0dd"><dt-math>\lambda_1=0.01</dt-math></span>,
    <span style="display: inline-block; padding-left: 4px; border-left: 3px solid #fa9fb5"><dt-math>\lambda_2=0.1</dt-math></span>, and
    <span style="display: inline-block; padding-left: 4px; border-left: 3px solid #c51b8a"><dt-math>\lambda_3=1</dt-math></span>. Though the decrease is no longer monotonic, but significantly faster. </figcaption>
  <figcaption style="position:absolute; text-align:left; top:210px; left:15px; width:280px; height:120px; font-size:15px"> <dt-math>f(w^k) - f(w^\star)</dt-math></figcaption>
  <figcaption style="position:absolute; text-align:left; top:430px; left:140px; width:780px; height:120px"> Note that the optimal parameters do not necessarily imply the fastest convergence, though, only the fastest asymptotic convergence rate. </figcaption>

  <div class="figtext" style="position:absolute; left:705px; top:11px">Step-size α = </div>
  <div class="figtext" style="position:absolute; left:464px; top:30px">Momentum β = </div>

  <div id = "sliderStep2D" style="position:absolute; left:550px; width:250px; height:100px; top:10px"></div>
  <div id = "milestonesMomentum" style="position:relative; left:15px"></div>
  </figure>
  <script>
    deleteQueue.push(renderLoading(d3.select("#milestonesMomentumFig")))
    renderQueue.push(function(callback) {
      var graphDiv = d3.select("#milestonesMomentum")
                   .style("width",  920 + "px")
                   .style("height", 300 + "px")
                   .style("top", "170px")
                   .style("position", "relative")
                   .style("margin-left", "auto")
                   .style("margin-right", "auto")
                   .attr("width", 920)
                   .attr("height", 500)

    var svg = graphDiv.append("svg").attr("width", 940).attr("height", 500)

    var update = renderMilestones(svg, function() {})
    var reset = slider2D(d3.select("#sliderStep2D"),
                           function(x,y) { update(x,y) },
                           1,
                           100)

    // // Swoopy Annotator
    annotations = [
      {
        "x": 0,
        "y": 0,
        "path": "M 798,98 A 27.97 27.97 0 0 0 760.9999389648438,70.9999771118164",
        "text": "Optimal parameters",
        "textOffset": [
          740,
          109
        ]
      }
    ]
    var sel = drawAnnotations(d3.select("#milestonesMomentumFig"), annotations)
    sel.selectAll("text").style("cursor", "pointer").style("pointer-events","all").on("click", reset)
    callback(null);
  });

  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->


  <figure id="laplacianConditioning" style="width:900px; height:265px">
  <svg width="900" height="300" id="graph"></svg>
  <figcaption id = "expander" style="position:absolute; left:70px; top:210px; width:200px">Small world graphs, like expanders and dense graphs, have excellent conditioning</figcaption>

  <figcaption id = "expander" style="position:absolute; left:370px; top:210px; width:200px">The conditioning of grids improves with its dimensionality.</figcaption>

  <figcaption id = "expander" style="position:absolute; left:670px; top:210px; width:200px">And long, wiry graphs, like paths, condition poorly. </figcaption>

  </figure>
  <script src="assets/graph.js"></script>
  <script>
    deleteQueue.push(renderLoading(d3.select("#laplacianConditioning")))
    renderQueue.push(function(callback) {
      var g1 = d3.select("#graph").append("g")
      genExpander(g1)

      var g2 = d3.select("#graph").append("g").attr("transform", "translate(300,0)")
      genGrid(g2)

      var g3 = d3.select("#graph").append("g").attr("transform", "translate(600,0)")
      genPath(g3);
      callback(null);
    });
  </script>

<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- --------------------------------------------------------------------------------------------------------- -->

  <figure id="rosenViz" style="width:950px; height:630px">
    <div id = "sliderz" style="position:absolute;top: 14px;left:575px;"></div>
    <div class="figtext" style="position:absolute; pointer-events:none; top:14px; width:300px; left:729px; height:100px">Step-size α = </div>
    <div class="figtext" style="position:absolute; pointer-events:none; top:35px; width:488px; left:488px; height:100px">Momentum β = </div>

    <figcaption style="width:270px; position:absolute; left:150px; top:38px">Here we see the first 50 iterates of momentum on the Convex Rosenbrock for <dt-math>n=25</dt-math>. The behavior here is similar to that of any Linear First Order Algorithm. </figcaption>

    <div style="position:absolute; top:150px; left:-80px">
    <figcaption style="width:160px; position:absolute; left:670px; top:90px">This triangle is a "dead zone" of our iterates. The iterates are always 0, no matter what the parameters. </figcaption>
    <figcaption style="width:160px; position:absolute; left:670px; top:310px">The remaining expanding space is the "light cone" of our iterate's influence. Momentum does very well here with the optimal parameters. </figcaption>
    <div id = "iterates" style="position:absolute; top:60px; left:0"></div>
    <div class="figtext" style="position:absolute; top:-2px; width:300px; left:452px; height:100px">Error</div>
    <div id = "rosen_colorbar1" style="position:absolute; top:0px; width:300px; left:440px; height:100px"></div>
    <div class="figtext" style="position:absolute; top:-2px; width:300px; left:232px; height:100px">Weights</div>
    <div id = "rosen_colorbar2" style="position:absolute; top:0px; width:300px; left:220px; height:100px"></div>
    </div>
  </figure>
  <script>
  deleteQueue.push(renderLoading(d3.select("#rosenViz")))
  renderQueue.push(function(callback) {
    var RQ = [[0.033430859446525574,0.06637421995401382,0.09834969788789749,0.1288910210132599,0.1575528085231781,0.18391713500022888,0.20759953558444977,0.22825466096401215,0.24558131396770477,0.25932684540748596,0.2692908048629761,0.2753278911113739,0.2773500978946686,0.2753278911113739,0.2692908048629761,0.25932684540748596,0.24558131396770477,0.22825466096401215,0.20759953558444977,0.18391713500022888,0.1575528085231781,0.1288910210132599,0.09834969788789749,0.06637421995401382,0.033430859446525574],[-0.06637421995401382,-0.1288910210132599,-0.18391713500022888,-0.22825466096401215,-0.25932684540748596,-0.2753278911113739,-0.2753278911113739,-0.25932684540748596,-0.22825466096401215,-0.18391713500022888,-0.1288910210132599,-0.06637421995401382,-1.917815576756455e-14,0.06637421995401382,0.1288910210132599,0.18391713500022888,0.22825466096401215,0.25932684540748596,0.2753278911113739,0.2753278911113739,0.25932684540748596,0.22825466096401215,0.18391713500022888,0.1288910210132599,0.06637421995401382],[0.09834969788789749,0.18391713500022888,0.24558131396770477,0.2753278911113739,0.2692908048629761,0.22825466096401215,0.1575528085231781,0.06637421995401382,-0.033430859446525574,-0.1288910210132599,-0.20759953558444977,-0.25932684540748596,-0.2773500978946686,-0.25932684540748596,-0.20759953558444977,-0.1288910210132599,-0.033430859446525574,0.06637421995401382,0.1575528085231781,0.22825466096401215,0.2692908048629761,0.2753278911113739,0.24558131396770477,0.18391713500022888,0.09834969788789749],[0.1288910210132599,0.22825466096401215,0.2753278911113739,0.25932684540748596,0.18391713500022888,0.06637421995401382,-0.06637421995401382,-0.18391713500022888,-0.25932684540748596,-0.2753278911113739,-0.22825466096401215,-0.1288910210132599,-1.2834394835694717e-14,0.1288910210132599,0.22825466096401215,0.2753278911113739,0.25932684540748596,0.18391713500022888,0.06637421995401382,-0.06637421995401382,-0.18391713500022888,-0.25932684540748596,-0.2753278911113739,-0.22825466096401215,-0.1288910210132599],[-0.1575528085231781,-0.25932684540748596,-0.2692908048629761,-0.18391713500022888,-0.033430859446525574,0.1288910210132599,0.24558131396770477,0.2753278911113739,0.20759953558444977,0.06637421995401382,-0.09834969788789749,-0.22825466096401215,-0.2773500978946686,-0.22825466096401215,-0.09834969788789749,0.06637421995401382,0.20759953558444977,0.2753278911113739,0.24558131396770477,0.1288910210132599,-0.033430859446525574,-0.18391713500022888,-0.2692908048629761,-0.25932684540748596,-0.1575528085231781],[-0.18391713500022888,-0.2753278911113739,-0.22825466096401215,-0.06637421995401382,0.1288910210132599,0.25932684540748596,0.25932684540748596,0.1288910210132599,-0.06637421995401382,-0.22825466096401215,-0.2753278911113739,-0.18391713500022888,-4.583645525716709e-15,0.18391713500022888,0.2753278911113739,0.22825466096401215,0.06637421995401382,-0.1288910210132599,-0.25932684540748596,-0.25932684540748596,-0.1288910210132599,0.06637421995401382,0.22825466096401215,0.2753278911113739,0.18391713500022888],[-0.20759953558444977,-0.2753278911113739,-0.1575528085231781,0.06637421995401382,0.24558131396770477,0.25932684540748596,0.09834969788789749,-0.1288910210132599,-0.2692908048629761,-0.22825466096401215,-0.033430859446525574,0.18391713500022888,0.2773500978946686,0.18391713500022888,-0.033430859446525574,-0.22825466096401215,-0.2692908048629761,-0.1288910210132599,0.09834969788789749,0.25932684540748596,0.24558131396770477,0.06637421995401382,-0.1575528085231781,-0.2753278911113739,-0.20759953558444977],[-0.22825466096401215,-0.25932684540748596,-0.06637421995401382,0.18391713500022888,0.2753278911113739,0.1288910210132599,-0.1288910210132599,-0.2753278911113739,-0.18391713500022888,0.06637421995401382,0.25932684540748596,0.22825466096401215,4.337912797388764e-15,-0.22825466096401215,-0.25932684540748596,-0.06637421995401382,0.18391713500022888,0.2753278911113739,0.1288910210132599,-0.1288910210132599,-0.2753278911113739,-0.18391713500022888,0.06637421995401382,0.25932684540748596,0.22825466096401215],[-0.24558131396770477,-0.22825466096401215,0.033430859446525574,0.25932684540748596,0.20759953558444977,-0.06637421995401382,-0.2692908048629761,-0.18391713500022888,0.09834969788789749,0.2753278911113739,0.1575528085231781,-0.1288910210132599,-0.2773500978946686,-0.1288910210132599,0.1575528085231781,0.2753278911113739,0.09834969788789749,-0.18391713500022888,-0.2692908048629761,-0.06637421995401382,0.20759953558444977,0.25932684540748596,0.033430859446525574,-0.22825466096401215,-0.24558131396770477],[-0.25932684540748596,-0.18391713500022888,0.1288910210132599,0.2753278911113739,0.06637421995401382,-0.22825466096401215,-0.22825466096401215,0.06637421995401382,0.2753278911113739,0.1288910210132599,-0.18391713500022888,-0.25932684540748596,-2.6265288907570752e-15,0.25932684540748596,0.18391713500022888,-0.1288910210132599,-0.2753278911113739,-0.06637421995401382,0.22825466096401215,0.22825466096401215,-0.06637421995401382,-0.2753278911113739,-0.1288910210132599,0.18391713500022888,0.25932684540748596],[0.2692908048629761,0.1288910210132599,-0.20759953558444977,-0.22825466096401215,0.09834969788789749,0.2753278911113739,0.033430859446525574,-0.25932684540748596,-0.1575528085231781,0.18391713500022888,0.24558131396770477,-0.06637421995401382,-0.2773500978946686,-0.06637421995401382,0.24558131396770477,0.18391713500022888,-0.1575528085231781,-0.25932684540748596,0.033430859446525574,0.2753278911113739,0.09834969788789749,-0.22825466096401215,-0.20759953558444977,0.1288910210132599,0.2692908048629761],[0.2753278911113739,0.06637421995401382,-0.25932684540748596,-0.1288910210132599,0.22825466096401215,0.18391713500022888,-0.18391713500022888,-0.22825466096401215,0.1288910210132599,0.25932684540748596,-0.06637421995401382,-0.2753278911113739,-2.224606886845463e-15,0.2753278911113739,0.06637421995401382,-0.25932684540748596,-0.1288910210132599,0.22825466096401215,0.18391713500022888,-0.18391713500022888,-0.22825466096401215,0.1288910210132599,0.25932684540748596,-0.06637421995401382,-0.2753278911113739],[0.2773500978946686,1.2625047254649028e-16,-0.2773500978946686,-6.312523627324514e-16,0.2773500978946686,8.83753307825432e-16,-0.2773500978946686,-8.83753307825432e-16,0.2773500978946686,1.5781309068311285e-15,-0.2773500978946686,-4.734392720493385e-16,0.2773500978946686,2.0200075607438445e-15,-0.2773500978946686,-1.7990691808479273e-15,0.2773500978946686,1.6728188141805554e-15,-0.2773500978946686,-1.4518804342846382e-15,0.2773500978946686,-3.4718879950284827e-16,-0.2773500978946686,1.2625047254649028e-15,0.2773500978946686],[-0.2753278911113739,0.06637421995401382,0.25932684540748596,-0.1288910210132599,-0.22825466096401215,0.18391713500022888,0.18391713500022888,-0.22825466096401215,-0.1288910210132599,0.25932684540748596,0.06637421995401382,-0.2753278911113739,-1.0026396759284933e-15,0.2753278911113739,-0.06637421995401382,-0.25932684540748596,0.1288910210132599,0.22825466096401215,-0.18391713500022888,-0.18391713500022888,0.22825466096401215,0.1288910210132599,-0.25932684540748596,-0.06637421995401382,0.2753278911113739],[0.2692908048629761,-0.1288910210132599,-0.20759953558444977,0.22825466096401215,0.09834969788789749,-0.2753278911113739,0.033430859446525574,0.25932684540748596,-0.1575528085231781,-0.18391713500022888,0.24558131396770477,0.06637421995401382,-0.2773500978946686,0.06637421995401382,0.24558131396770477,-0.18391713500022888,-0.1575528085231781,0.25932684540748596,0.033430859446525574,-0.2753278911113739,0.09834969788789749,0.22825466096401215,-0.20759953558444977,-0.1288910210132599,0.2692908048629761],[-0.25932684540748596,0.18391713500022888,0.1288910210132599,-0.2753278911113739,0.06637421995401382,0.22825466096401215,-0.22825466096401215,-0.06637421995401382,0.2753278911113739,-0.1288910210132599,-0.18391713500022888,0.25932684540748596,1.770693656524247e-16,-0.25932684540748596,0.18391713500022888,0.1288910210132599,-0.2753278911113739,0.06637421995401382,0.22825466096401215,-0.22825466096401215,-0.06637421995401382,0.2753278911113739,-0.1288910210132599,-0.18391713500022888,0.25932684540748596],[0.24558131396770477,-0.22825466096401215,-0.033430859446525574,0.25932684540748596,-0.20759953558444977,-0.06637421995401382,0.2692908048629761,-0.18391713500022888,-0.09834969788789749,0.2753278911113739,-0.1575528085231781,-0.1288910210132599,0.2773500978946686,-0.1288910210132599,-0.1575528085231781,0.2753278911113739,-0.09834969788789749,-0.18391713500022888,0.2692908048629761,-0.06637421995401382,-0.20759953558444977,0.25932684540748596,-0.033430859446525574,-0.22825466096401215,0.24558131396770477],[0.22825466096401215,-0.25932684540748596,0.06637421995401382,0.18391713500022888,-0.2753278911113739,0.1288910210132599,0.1288910210132599,-0.2753278911113739,0.18391713500022888,0.06637421995401382,-0.25932684540748596,0.22825466096401215,9.870699398085384e-16,-0.22825466096401215,0.25932684540748596,-0.06637421995401382,-0.18391713500022888,0.2753278911113739,-0.1288910210132599,-0.1288910210132599,0.2753278911113739,-0.18391713500022888,-0.06637421995401382,0.25932684540748596,-0.22825466096401215],[-0.20759953558444977,0.2753278911113739,-0.1575528085231781,-0.06637421995401382,0.24558131396770477,-0.25932684540748596,0.09834969788789749,0.1288910210132599,-0.2692908048629761,0.22825466096401215,-0.033430859446525574,-0.18391713500022888,0.2773500978946686,-0.18391713500022888,-0.033430859446525574,0.22825466096401215,-0.2692908048629761,0.1288910210132599,0.09834969788789749,-0.25932684540748596,0.24558131396770477,-0.06637421995401382,-0.1575528085231781,0.2753278911113739,-0.20759953558444977],[-0.18391713500022888,0.2753278911113739,-0.22825466096401215,0.06637421995401382,0.1288910210132599,-0.25932684540748596,0.25932684540748596,-0.1288910210132599,-0.06637421995401382,0.22825466096401215,-0.2753278911113739,0.18391713500022888,8.371955066048889e-16,-0.18391713500022888,0.2753278911113739,-0.22825466096401215,0.06637421995401382,0.1288910210132599,-0.25932684540748596,0.25932684540748596,-0.1288910210132599,-0.06637421995401382,0.22825466096401215,-0.2753278911113739,0.18391713500022888],[-0.1575528085231781,0.25932684540748596,-0.2692908048629761,0.18391713500022888,-0.033430859446525574,-0.1288910210132599,0.24558131396770477,-0.2753278911113739,0.20759953558444977,-0.06637421995401382,-0.09834969788789749,0.22825466096401215,-0.2773500978946686,0.22825466096401215,-0.09834969788789749,-0.06637421995401382,0.20759953558444977,-0.2753278911113739,0.24558131396770477,-0.1288910210132599,-0.033430859446525574,0.18391713500022888,-0.2692908048629761,0.25932684540748596,-0.1575528085231781],[-0.1288910210132599,0.22825466096401215,-0.2753278911113739,0.25932684540748596,-0.18391713500022888,0.06637421995401382,0.06637421995401382,-0.18391713500022888,0.25932684540748596,-0.2753278911113739,0.22825466096401215,-0.1288910210132599,-3.0802549003271684e-16,0.1288910210132599,-0.22825466096401215,0.2753278911113739,-0.25932684540748596,0.18391713500022888,-0.06637421995401382,-0.06637421995401382,0.18391713500022888,-0.25932684540748596,0.2753278911113739,-0.22825466096401215,0.1288910210132599],[-0.09834969788789749,0.18391713500022888,-0.24558131396770477,0.2753278911113739,-0.2692908048629761,0.22825466096401215,-0.1575528085231781,0.06637421995401382,0.033430859446525574,-0.1288910210132599,0.20759953558444977,-0.25932684540748596,0.2773500978946686,-0.25932684540748596,0.20759953558444977,-0.1288910210132599,0.033430859446525574,0.06637421995401382,-0.1575528085231781,0.22825466096401215,-0.2692908048629761,0.2753278911113739,-0.24558131396770477,0.18391713500022888,-0.09834969788789749],[-0.06637421995401382,0.1288910210132599,-0.18391713500022888,0.22825466096401215,-0.25932684540748596,0.2753278911113739,-0.2753278911113739,0.25932684540748596,-0.22825466096401215,0.18391713500022888,-0.1288910210132599,0.06637421995401382,6.798085926082532e-17,-0.06637421995401382,0.1288910210132599,-0.18391713500022888,0.22825466096401215,-0.25932684540748596,0.2753278911113739,-0.2753278911113739,0.25932684540748596,-0.22825466096401215,0.18391713500022888,-0.1288910210132599,0.06637421995401382],[0.033430859446525574,-0.06637421995401382,0.09834969788789749,-0.1288910210132599,0.1575528085231781,-0.18391713500022888,0.20759953558444977,-0.22825466096401215,0.24558131396770477,-0.25932684540748596,0.2692908048629761,-0.2753278911113739,0.2773500978946686,-0.2753278911113739,0.2692908048629761,-0.25932684540748596,0.24558131396770477,-0.22825466096401215,0.20759953558444977,-0.18391713500022888,0.1575528085231781,-0.1288910210132599,0.09834969788789749,-0.06637421995401382,0.033430859446525574]]

  RLambda = [4.6419172286987305,15.514562606811523,33.45938491821289,58.21471405029297,89.4195556640625,126.61888122558594,169.27023315429688,216.7516632080078,268.37078857421875,323.3748474121094,380.9618225097656,440.29193115234375,500.5,560.7080688476562,620.0381469726562,677.6251220703125,732.6292114257812,784.2483520507812,831.7297973632812,874.381103515625,911.5804443359375,942.7852783203125,967.5405883789062,985.4854125976562,996.3580932617188]

  var alpha = 0.003
  var beta = 0.8
  var b = zeros(25); b[0] =  249.75
  var iter = geniterMomentum(RQ, RLambda, b, alpha, beta).iter
  var res = function(i) { return iter(i)[0] }

  var sampleSVG = d3.select("#iterates")
    .style("display", "block")
      .append("svg")
      .attr("width", 770)
      .attr("height", 700)

  var rosen = d3.scaleLinear().domain([0,0.2,0.5,0.6,0.8]).range(colorbrewer.YlGnBu[5]);
  var jet = d3.scaleLinear().domain([-0,0.1,0.2,0.5,1.0,8]).range(colorbrewer.YlGnBu[5]);
  var contrast = d3.scaleLinear().domain([-12,0,12]).range(colorbrewer.YlGnBu[3]);

  var xstar = iter(10000000)
  var numIters = 52

  var pathstr = "M 8,0"

  for (var j = 0; j < 27; j++) {
    if (j != 26 && j > 0) {
      pathstr = pathstr + "L " + j*8 + "," + (j-1)*8 +  "L " + j*8 + "," + j*8
    }
    if (j == 0) {
      //pathstr = pathstr + "L " + j*8 + "," + j*8
    }
    if (j == 26) {
      pathstr = pathstr + "L " + j*8 + "," + (j-1)*8
    }
  }
  pathstr = pathstr + "L "+ 26*8 + ",0 L 8,0 "


  var Disps3 = []
  var errorPlot = sampleSVG.append("g").attr("transform", "translate(" + 440 + ",0)")
  for (var j = 0; j < numIters; j++) {
    var disp = errorPlot.append("g")

    var denter = disp.selectAll("rect")
        .data(iter(j)[1])
        .enter()

    denter.append("rect")
        .style("fill", function(d,i) { return rosen(d) })
        .attr("height", 7.7)
        .attr("width", 7.7)
        .attr("x", function(d, i){return i*8+ 10})
        .attr("y", function(d, i){return j*8 })
    Disps3.push(disp)
  }

  errorPlot.append("g").append("path").attr("d", pathstr).style("stroke","black").style("fill","none").style("stroke-width","1px").attr("transform", "translate(2,0.5)")

  var Disps4 = []
  var errorPlot = sampleSVG.append("g").attr("transform", "translate(" + 220 + ",0)")
  for (var j = 0; j < numIters; j++) {
    var disp = errorPlot.append("g")

    var denter = disp.selectAll("rect")
        .data(iter(j)[1])
        .enter()

    denter.append("rect")
        .style("fill", function(d,i) { return jet(d) })
        .attr("height", 7.7)
        .attr("width", 7.7)
        .attr("x", function(d, i){return i*8+ 10})
        .attr("y", function(d, i){return j*8 })

    if ((j % 10 == 0) || j == 0) {
    disp.append("text")
        .attr("class", "figtext")
        .attr("text-anchor", "end")
        .attr("x", 0)
        .attr("y", function(d, i){return (j*8 + 10) })
        .html( (j == 0) ? "Iteration 0" : "" + j)
    }

    Disps4.push(disp)
  }

  errorPlot.append("g").append("path").attr("d", pathstr).style("stroke","black").style("fill","none").style("stroke-width","1px").attr("transform", "translate(2,0.5)")


  function update(alpha, beta) {
    var iter = geniterMomentum(RQ, RLambda, b, Math.max(alpha, 0.00001), Math.min(Math.max(beta, 0.00001), 0.999)).iter
    for (var j = 0; j < numIters; j++) {
      var iterj = iter(j)
      Disps3[j].selectAll("rect").data(iterj[1]).merge(Disps3[j]).style("fill", function(d,i) { return rosen(Math.abs(d - xstar[1][i]) ) })
      Disps4[j].selectAll("rect").data(iterj[1]).merge(Disps4[j]).style("fill", function(d,i) { return jet(d) })

    }
  }

  var reset = slider2D(d3.select("#sliderz"), function(x,y) { update(x/RLambda[RLambda.length - 1],y) }, 4.6, 996.35)

  update(0.0035749243028120182, 0.8095238095238095)

  colorMap( d3.select("#rosen_colorbar1"),
            194,
            rosen,
            d3.scaleLinear().domain([0,1]).range([0, 194]) )

  colorMap( d3.select("#rosen_colorbar2"),
            194,
            jet,
            d3.scaleLinear().domain([0,1]).range([0, 194]) );

  // Swoopy Annotator
  var annotations = [
    {
      "x": 0,
      "y": 0,
      "path": "M 817,95 A 23.869 23.869 0 0 0 792,72",
      "text": "Optimal parameters",
      "textOffset": [
        767,
        109
      ]
    }
  ]
  var sel = drawAnnotations(d3.select("#rosenViz"), annotations)
  sel.selectAll("text").style("cursor", "pointer").style("pointer-events","all").on("click", reset)

  callback(null);
  });

  </script>

<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- --------------------------------------------------------------------------------------------------------- -->
  
  <script src="assets/stochastic_milestones.js"></script>
  <figure id="stochastic" style="position:relative; width:920px; height:460px">
  <figcaption style="position:absolute; text-align:left; top:30px; left:135px; width:280px; height:120px">We decompose the expected value of the objective value <dt-math>\mathbf{E} f(w) - f(w^\star)</dt-math> into a deterministic part <svg style="position:relative; top:2px; width:3px; height:14px; background:#e0ecf4"></svg> and a stochastic part <svg style="position:relative; top:2px; width:3px; height:14px; background:#9ebcda"></svg>. </figcaption>
  <figcaption style="position:absolute; text-align:left; top:210px; left:12px; width:116px; height:120px"> <span style="font-size:15px"><dt-math>\mathbf{E} f(w) - f(w^\star) </dt-math></span></figcaption>
  <figcaption style="position:absolute; text-align:right; top:240px; left:12px; width:116px; height:120px"> The small black dots are a single run of stochastic gradient</figcaption>

  <div class="figtext" style="position:absolute; left:705px; top:11px">Step-size α = </div>
  <div class="figtext" style="position:absolute; left:464px; top:30px">Momentum β = </div>

  <figcaption style="position:absolute; text-align:left; top:400px; left:135px; width:640px; height:60px">As <dt-cite key="sutskever2013importance"></dt-cite> observes, the optimization has two phases. In the initial transient phase the magnitude of the noise is smaller than the magnitude of the gradient, and Momentum still makes good progress. In the second, stochastic phase, the noise overwhelms the gradient, and momentum is less effective.</figcaption>

  <div id = "sliderStep2DD" style="position:absolute; left:550px; width:250px; height:100px; top:10px"></div>
  <div id = "stochasticgd" style="position:relative; left:15px"></div>
  </figure>

  <script>
  deleteQueue.push(renderLoading(d3.select("#stochastic")))
  renderQueue.push(function(callback) {
      var graphDiv = d3.select("#stochasticgd")
                   .style("width",  920 + "px")
                   .style("height", 300 + "px")
                   .style("top", "170px")
                   .style("position", "relative")
                   .style("margin-left", "auto")
                   .style("margin-right", "auto")
                   .attr("width", 920)
                   .attr("height", 500)

    var svg = graphDiv.append("svg").attr("width", 940).attr("height", 500)

    var update = renderStochasticMilestones(svg, function() {})
    var slidera = slider2D(d3.select("#sliderStep2DD"), function(x,y) { update(x,y) }, 1, 100)
    slidera(0.5,0.5)
  });
  </script>


<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- --------------------------------------------------------------------------------------------------------- -->

BBB

<hr style='height:2px;border-width:0;color:gray;background-color:gray'>
<!-- ------------------------------------------------------------------------------------------------------ -->
  
  
  <figure id = "flow" style="position: relative;display: block;margin-left: auto;margin-right: auto;width: 920px;height: 705px;">

  <figcaption style="left:790px; top:430px; position:absolute; width:130px">
      The eigenvectors of the colorization problem form a generalized Fourier basis for <dt-math>R^n</dt-math>. The smallest eigenvalues have low frequencies, hence gradient descent corrects high frequency errors well but not low frequency ones.
  </figcaption>

  </figure>
  <script src="assets/flow.js"></script>
  <script>
    deleteQueue.push(renderLoading(d3.select("#flow")))
    renderQueue.push(function(callback) {
      d3.queue()
        .defer(d3.json, "assets/data/Sigma.json")
        .defer(d3.json, "assets/data/matrix.json")
        .defer(d3.json, "assets/data/Uval.json")
        .await(function(error, FlowSigma, M, FlowU) {
          if (error) {
            console.error("Error loading data files");
          }
          else {
            var reset = renderFlowWidget(d3.select("#flow"), FlowSigma, M, FlowU)
            // Swoopy Annotator
            var annotations = [
              {
                "x": 0,
                "y": 0,
                "path": "M 389,55 A 28.57 28.57 0 0 0 352,30",
                "text": "Optimal parameters",
                "textOffset": [
                  341,
                  65
                ]
              }
            ]
            var sel = drawAnnotations(d3.select("#flow"), annotations)
            sel.selectAll("text").style("cursor", "pointer").style("pointer-events","all").on("click", reset)
          }
        });
      callback(null);
    });
  </script>


AAAAAAA


<script>

  // for (var i = 0; i < renderQueue.length; i++) {
  //   renderQueue[i](function() {})
  //   deleteQueue[i](function() {})
  // }
    setTimeout(function() {
      var q = d3.queue(1);
  
      d3.zip(deleteQueue,renderQueue).forEach(function(fn) {
        q.defer(function(callback) {
          fn[1](callback);
          fn[0](callback);
          renderMath(document.body);
        });
        q.defer(function(callback) {
          setTimeout(function() {
            callback(null);
          }, 50);
        });
      });
      q.await(function(error) {
        if (error) {
          console.error("Render error.", error)
        } else {
          console.log("Render done.")
        }
      });
    }, 50);
  
  // DEBUG
  // renderQueue.forEach( function (fn) { fn( function() {}) } )
  
  
  </script>
  